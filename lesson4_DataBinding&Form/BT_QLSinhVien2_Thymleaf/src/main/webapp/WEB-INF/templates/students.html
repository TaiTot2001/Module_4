<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Danh sách sinh viên</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-4">

<!-- Thông báo -->
<div th:if="${message}" style="color:green" th:text="${message}"></div>
<div style="color: green;" th:text="${massage}"></div>

<h2>Danh sách sinh viên</h2>

<!-- Form lọc -->
<form th:action="@{/students}" method="get" class="row g-2 mb-3">
    <div class="col-auto">
        <input type="text" class="form-control" name="q"
               placeholder="Tìm theo mã số / họ tên"
               th:value="${q}">
    </div>
    <div class="col-auto">
        <select name="sort" class="form-select">
            <option value="id" th:selected="${sort == 'id'}">Mã số</option>
            <option value="name" th:selected="${sort == 'name'}">Họ tên</option>
            <option value="score" th:selected="${sort == 'score'}">Điểm</option>
        </select>
    </div>
    <div class="col-auto">
        <select name="dir" class="form-select">
            <option value="asc" th:selected="${dir == 'asc'}">Tăng dần</option>
            <option value="desc" th:selected="${dir == 'desc'}">Giảm dần</option>
        </select>
    </div>
    <div class="col-auto">
        <button type="submit" class="btn btn-primary">Lọc</button>
    </div>
    <div class="col-auto ms-auto">
        <a th:href="@{/students/add}" class="btn btn-success">➕ Thêm sinh viên</a>
    </div>
</form>

<!-- Bảng danh sách -->
<table class="table table-bordered table-striped align-middle">
    <colgroup>
        <col style="width: 10%;">
        <col style="width: 35%;">
        <col style="width: 15%;">
        <col style="width: 15%;">
        <col style="width: 25%;">
    </colgroup>
    <thead>
    <tr>
        <th class="text-center">Mã số</th>
        <th class="text-center">Họ tên</th>
        <th class="text-center">Điểm</th>
        <th class="text-center">Thứ hạng</th>
        <th class="text-center">Chức năng</th>
    </tr>
    </thead>
    <tbody>
    <!-- Nếu controller trả List<Student> thì dùng ${students}, nếu Page<Student> thì dùng ${students.content} -->
    <tr th:each="s : ${students}">
        <td class="text-center" th:text="${s.id}"></td>
        <td class="text-center align-middle" th:text="${s.name}"></td>
        <td class="text-center" th:text="${s.score}"></td>
        <td class="text-center" th:text="${s.rank}"></td>
        <td class="text-center">
            <a th:href="@{/students/detail(id=${s.id})}" class="btn btn-info btn-sm">Chi tiết</a>
            <a th:href="@{/students/edit(id=${s.id})}" class="btn btn-warning btn-sm">Sửa</a>
            <form th:action="@{/students/delete}" method="Get"
                  style="display:inline"
                  onsubmit="return confirm('Bạn có chắc muốn xóa sinh viên này không?');">
                <input type="hidden" name="id" th:value="${s.id}">
                <button type="submit" class="btn btn-danger btn-sm">Xóa</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<!-- Phân trang -->
<nav>
    <ul class="pagination">
        <li th:each="p : ${#numbers.sequence(1, totalPages)}"
            th:classappend="${p == page} ? 'active'">

            <!-- Trang hiện tại -->
            <span th:if="${p == page}" class="page-link" th:text="${p}"></span>

            <!-- Các trang khác -->
            <a th:if="${p != page}" class="page-link"
               th:href="@{/students(q=${q}, sort=${sort}, dir=${dir}, size=${size}, page=${p})}"
               th:text="${p}"></a>
        </li>
    </ul>
</nav>

</body>
</html>
